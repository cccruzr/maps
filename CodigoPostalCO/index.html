<html>

<head>
    <meta charset=utf-8 />
    <title>Colombia: Código Postal</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <!-- Load Leaflet style from CDN-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" 
    integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
    crossorigin=""/>
    
    <!-- Load geocoding plugin after Leaflet -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.2/leaflet-geocoder-mapzen.css">

  	<!-- Locate Control -->
  	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.mapbox.css' rel='stylesheet' />
	
	<!-- Sidebar + Easy buttons style-->
	<link rel="stylesheet" href="css/L.Control.Sidebar.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">

	<!-- Custom style-->
	<link rel="stylesheet" href="css/custom.css">
</head>

<body>
    <div id="map"></div>
    <div id="info-pane" class="leaflet-bar"></div>
    <div id="sidebar">
		<table style="width:100%">
		    <tr>
		        <th align="left"><p style="font-size: 1em; text-decoration: underline; vertical-align: middle">
	    		<h2><b>INSTRUCCIONES</b></h2></th>
		        <th><img style="text-align: right" src="img/cp-logo.png" width="80px"></th>
		    </tr>
		</table>
			<p><li>Ubique el mouse en la localización de búsqueda
    			para conocer su código postal.</li></p>
    		<p><li>Click en la lupa para usar el geolocalizador:
				búsqueda por dirección o lugar de interés.</li></p>
			<p><li>Para encontrar su localización actual haga
				click en el botón de geolocalización.</li></p>
		<br><br><p style="font-size: 0.85em;">
		<i><b>NOTA:</b> Esta aplicación web NO es oficial. El visor oficial se puede
		encontrar <a href="http://visor.codigopostal.gov.co/472/visor/" target="_blank">acá</a>.
		</p>
    </div>

    <!-- Load Leaflet from CDN-->
	<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
	integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
	crossorigin=""></script>

  	<!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.0.8"
    integrity="sha384-ze7rgny7/YGFxBlVgTBdOABNWe5V9BYjju/qwqJhCU8XJHtuEnRlbUpN5lXyY706"
    crossorigin=""></script>

    <!-- Load geocoding plugin after Leaflet -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.2/leaflet-geocoder-mapzen.js"></script>

	<!-- Locate Control -->
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.min.js'></script>
	
	<!-- Control Sidebar -->
	<script src="js/L.Control.Sidebar.js"></script>

	<!-- Easy buttons -->
	<script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>


    <script>
    //Set map bounds
    var bounds = new L.latLngBounds(       //Map boundaries
    	L.latLng(14, -83),     //UpperLeft 13.81674, -82.96875
    	L.latLng(-5.5, -60)    //BottomRight -5.09094, -66.79687
    );

    //Initialize map
    var map = L.map('map', {
        maxBounds: bounds,
        maxBoundsViscosity: 0.8,
        minZoom: 6,	//Maximum zoom out
    }).setView([4.7110, -74.0721], 6);

    //Mapbox Streets Tiles
    L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY2NjcnV6ciIsImEiOiJjajN3NTh6ZTUwMDE4MzJwODl6OW04a2poIn0.LUFTG4do1t5B5BKBsYC2UQ', {
	    attribution: '<a href="http://cccruzr.github.io/">Camilo Cruz</a> | Datos ©<a href="http://www.codigopostal.gov.co/">Código Postal de Colombia</a> | &copy;<a href="http://openstreetmap.org">OpenStreetMap</a> | ©<a href="http://mapbox.com">Mapbox</a>',
	    maxZoom: 18,
	    id: 'mapbox.streets',
	}).addTo(map);

    //Postal Codes SHP call
    var zipcodes = L.esri.featureLayer({
        //url: 'https://services3.arcgis.com/3845X4ZJand4K8Fh/arcgis/rest/services/colombia_codigo_postal_shp/FeatureServer/0',
        url: 'https://services3.arcgis.com/3845X4ZJand4K8Fh/arcgis/rest/services/Colombia_C%C3%B3digo_Postal_(Simplificada)/FeatureServer/0',
        simplifyFactor: 0.25,
        precision: 5,
        fields: ['FID', 'Codigo_Pos'],
        style: {
            color: '#A9A9A9',
            weight: 0.5
        }
    }).addTo(map);

    //Geolocate control
    L.control.locate().addTo(map);

    //Geocoding search
    L.control.geocoder('mapzen-6FaNpVv', {
    	bounds: bounds,
    	//panToPoint: true,
    	textStrings: {
		    INPUT_PLACEHOLDER: 'Buscar (Lugar o Dirección)',
		    INPUT_TITLE_ATTRIBUTE: 'Buscar',
		    RESET_TITLE_ATTRIBUTE: 'Restablecer',
		    NO_RESULTS: 'No se encontraron resultados.',
		    ERROR_403: 'Se necesita una "API KEY" válida para usar la búsqueda.',
		    ERROR_404: 'No se encontró el servicio de búsqueda. :-(',
		    ERROR_408: 'El servicio demoró en responder. Intente de nuevo en unos instantes.',
		    ERROR_429: 'Hay muchas solicitudes en el momento. Intente de nuevo más tarde.',
		    ERROR_500: 'El servicio de búsqueda no está funcionando en el momento. Intente de nuevo más tarde.',
		    ERROR_502: 'Se perdió la conexión. Intente de nuevo más tarde.',
		    ERROR_DEFAULT: 'El servicio de búsqueda presenta inconvenientes. :-('
		  }
    }).addTo(map);

    //Menu button
    L.easyButton( '<i class="fa fa-info-circle" aria-hidden="true"></i>', function(){
		sidebar.toggle();
	}).addTo(map);

    //Sidebar
    var sidebar = L.control.sidebar('sidebar', {
        closeButton: true,
        position: 'left'
    });
    map.addControl(sidebar);

    // Tooltip update on mouse events
    var oldId;

    zipcodes.on('mouseout', function(e) {
        document.getElementById('info-pane').innerHTML = '';
        zipcodes.resetFeatureStyle(oldId);
    });

    zipcodes.on('mouseover', function(e) {
        oldId = e.layer.feature.id;
        document.getElementById('info-pane').innerHTML = '<b>' + e.layer.feature.properties.Codigo_Pos + '</b>';
        zipcodes.setFeatureStyle(e.layer.feature.id, {
            color: '#9D78D2',
            weight: 3,
            opacity: 1
        });
    });
    </script>
</body>

</html>
